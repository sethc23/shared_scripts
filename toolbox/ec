#!/bin/bash

# [[ $1 = emacs ]]                                                                                    \
#     && which osascript > /dev/null 2>&1 && osascript -e 'tell application "Emacs" to activate'      \
#     || /Applications/Emacs.app/Contents/MacOS/bin/emacsclient -n -c "$@"

# [[ -z $EMACSCLIENT ]]       \
    # && _ec_client app

# fpath=$(realfullpath "$@")

# CMD=$(echo "$EMACSCLIENT -n -c $fpath")
# unset fpath

# echo "$CMD"
# eval "$CMD"

# /opt/local/bin/emacsclient -n -c "$@"

source ~/.scripts/shell_env/shared/services/emacs

DISPLAY=
if [[ $(uname -o) = Darwin ]]; then
    EXEC="/opt/local/bin/emacsclient"
    # EXEC="/Applications/Emacs.app/Contents/MacOS/bin/emacsclient"
    EMACS_SOCKET=$(e-get-x11-socket)
elif [[ $(uname -o) = GNU/Linux ]]; then
    EXEC="/usr/local/bin/emacsclient"
    DISPLAY="-d :51"
    # EMACS_SOCKET=$(e-get-protocol-socket)
    EMACS_SOCKET=$(e-get-x11-socket)
    # EMACS_SOCKET="/tmp/emacs1000/ub2-x11-server"
    #
    # /usr/local/bin/emacsclient -n -c -d :51 $@ -s /tmp/emacs1000/ub2-x11-server
    #
fi

# e-get-socket
# e-get-x11-socket
# e-get-protocol-socket

# EMACS_SOCKET=$(sudo lsof -U|grep emacs|grep unix|grep '/'|column -t | tr -s " "|cut -d ' ' -f8|sed -r 's/\s/\n/g'|uniq|grep x11|tail -n 1)
# EMACS_SOCKET_BAK=$(sudo lsof -U|grep emacs|grep unix|grep '/'|column -t | tr -s " "|cut -d ' ' -f8|sed -r 's/\s/\n/g'|head -n 1)

[[ -n $EMACS_SOCKET ]]                  \
    && $EXEC -n -c $DISPLAY $@ -s $EMACS_SOCKET  \
    || echo "emacsclient socket not found"

