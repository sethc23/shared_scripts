#!env zsh

# date > /tmp/tmp_subl_open
# (from realpath man ...)
#
# -e, --canonicalize-existing
#        all components of the path must exist
#
# -m, --canonicalize-missing
#        no path components need exist or be a directory
#

_params="${@: 1:-1}"
_target=$(echo "${@: -1}"|sed -r 's/[ ]/\\ /g')

FPATH=$(realpath -e "$_target" 2> /dev/null)
FPATH=$(echo "$FPATH"|sed -r 's/[ ]/\\ /g')
FPATH=$(readlink -e $FPATH)

test -e "$FPATH" || (echo "Unreadable target path: '"$_target"'" && exit 99)

CMD_BASE="open -a \"Sublime Text\""
CMD_PARAMS=
[[ -n $_params ]] && CMD_PARAMS="--args \'$_params\'"

CMD="$CMD_BASE $FPATH $CMD_PARAMS"

[[ ! $(uname -o) = Darwin ]]            \
    && CMD="ssh admin '$CMD_BASE /Volumes/ub2$FPATH $CMD_PARAMS'"

# echo "$CMD" >> /tmp/tmp_subl_open
# echo "$CMD"
eval $CMD
